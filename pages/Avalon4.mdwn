# Pictures
 [[!img "AvalonA3233chips.jpeg" size=320x320]]  [[!img "Avalon4-a3222-1.jpg" size=320x320]]  [[!img "Avalon4-A3222-3.jpg" size=320x320]]

# A3222

* Datasheet [download here](http://downloads.canaan-creative.com/browser/hardware/A3222/datasheet/A3222Q56-140627-V01-EN.pdf)

	Package: QFN56-8X8, 0.5mm pitch
	Core voltage: 0.65 ~ 0.8V
	Chip frequency: 400MHz
	Hashrate: 25-30G (Normal，0.75V)
	Power usage: 0.45-0.55W/G on ASIC side
	VDDIO: 1.5 ~ 2.5V

## SPI Example
 [[!img "Avalon4-SPI-EXAMPLE.jpeg" size=640x640]]

	a real data:
	1st:
	work n chip1
	{576'hc16801619d8d4242e06e5fab25a54bbe222e8b877848c34beea79cd6528caf7e33cde02a983dab158119ce2a1c9fc4eddac8ce296d0fd9da6e18f645087e051a2d547050e8dc86b1, 64'ha, 32'h1, 32'h1, 32'h1} 
	work n chip0
	{576'h1bed3ba0a2cb45c1d8f8ef6712146495c44192c07145fd6d974bf4bb8f41371d65c90d1e9cb18a17fa77fe7d13cdfd7b0063910762a5f25c06b168ae087e051a895170504ac1d001, 64'h5, 32'h1, 32'h1, 32'h1}
	
	2nd:
	work n+1 chip1
	{576'h0, 64'hb, 32'h1, 32'h1, 32'h1}
	work n+1 chip0
	{576'h0, 64'h6, 32'h1, 32'h1, 32'h1}
	
	3rd:
	work n+2 chip1
	{576'h0, 64'hc, 32'h1, 32'h1, 32'h1}
	work n+2 chip0
	{576'h0, 64'h7, 32'h1, 32'h1, 32'h1}
	
	then get nonce 32'h1beebba0 for chip0, 32'hc1698161 for chip1;

# Avalon4
Each module include 40 A3222 ASICs, the mdoule should be working at 1TH/S and using 700W power.

 [[!img "Avalon4-BP-1.jpg" size=320x320]]  [[!img "Avalon4-BP-2.jpg" size=320x320]]
 [[!img "Avalon4-HU-1.jpg" size=320x320]]  [[!img "Avalon4-HU-2.jpg" size=320x320]]
 [[!img "Avalon4-MM-1.jpg" size=320x320]]  [[!img "Avalon4-MM-2.jpg" size=320x320]]
 [[!img "Avalon4-PW-1.jpg" size=320x320]]

## JTAG Port
 [[!img "Avalon4-JTAG-PIN.jpeg" size=320x320]]  [[!img "Avalon4-XILINX-Cable.jpeg" size=320x320]]

## PMU
 [[!img "Avalon4-PMU-Connector.jpeg" size=310x310]]  [[!img "Avalon4-PMU-Connector-Header.jpeg" size=310x310]]

 [[!img "Avalon4-PMU-P1.jpeg" size=310x310]]  [[!img "Avalon4-PMU-P2.jpeg" size=310x310]]

## HU
 [[!img "Avalon-HU.jpeg" size=310x310]]

## Power & GND
 [[!img "Avalon4-Power-GND.jpeg" size=320x320]]

## LED
From left to right
	ERR/WARN/TXD/RXD/N1/N2/PG1/PG2

## Avalon4 CGMiner Under Ubuntu 14.04
###  Download
	Inside your home directory, download Cgminer
	git clone https://github.com/Canaan-Creative/cgminer

### Compile
	cd cgminer
	git checkout origin/avalon4 -b avalon4
	./autogen.sh --enable-avalon4
	make -j 4

### Run
	sudo ./cgminer --avalon4-fan 60 --avalon4-freq 200 --avalon4-voltage 7125 --lowmem -o http://stratum.pool:3333 -u  work -p pass 
	or
	sudo ./cgminer --avalon4-fan 60 --avalon4-freq 200 --avalon4-voltage 7125 --lowmem  -o http://stratum.pool:3333 -u  work -p pass --api-allow W:192.168.2,W:192.168.2.1 --api-listen $@ 2>./log

### Tweak

* Led
	Format: **ascsetASCN,led,modularid**
	eg: cgminer-api "ascset0,led,1"

* Fan
	Format: **ascsetASCN,fan,fanmin[[-fanmax]]**
	eg: cgminer-api "ascset0,fan,10" or cgminer-api "ascset0,fan,10-100"


## Technical details

* The auc take **1~2ms** betwwen write and read. even the polling delay is 0 (4800 means 1ms)
* The cgminer each polling takes **~20ms**. even the polling delay is 0ms

# AUC
Avalon USB2IIC converter, USD VID:PID **29f1:33f2**

## LED

* PWR: Power indicator
* R: AUC response error
* G: IIC Xfer
* B: AUC init

## AUC Firmware

### [http://downloads.canaan-creative.com/software/avalon4/auc/20141122/ 20141122]

* AUC version: **AUC-20141122**
* Reset asic when usb config changed(true->false)

### [http://downloads.canaan-creative.com/software/avalon4/auc/20141105/ 20141105]

* AUC version: **AUC-20141105**
* Code cleanup
* Improve for firmware burning

### [http://downloads.canaan-creative.com/software/avalon4/auc/20141103/ 20141103]

* AUC version: **AUC-20141103**
* Add watchdog
* Code cleanup

### [http://downloads.canaan-creative.com/software/avalon4/auc/20141027/ 20141027]

* AUC version: **AUC-20141027**
* Change Manufacturer to [CANAAN](http://www.canaan-creative.com)

### [http://downloads.canaan-creative.com/software/avalon4/auc/20141019/ 20141019]

* AUC version: **AUC-20141019**
* First version of AUC firmware
* Source URL: https://github.com/Canaan-Creative/Avalon-USB-converter

# RPi/703N Firmware
### Daily Building

* **http://build.canaan-creative.com:8080/~mikeqin/build/**

### [http://downloads.canaan-creative.com/software/avalon4/openwrt/20141124_1908/ 20141124]

* Add MM41 support
* Add mm count value in API status
* Fix the matching_work error
* Update dh calculation for luci
* Change theme name to avalon


### [http://downloads.canaan-creative.com/software/avalon4/openwrt/20141118_1858/ 20141118]

* Adjust module voltage by ascset
* A new theme was added to luci,and use it as default

### [http://downloads.canaan-creative.com/software/avalon4/openwrt/20141112_2245/ 20141112]

* Support RPi B/B+ version
* Change default IIC speed from 1M to 400K
* Add Avalon4 MM rolling ntime offset
* Update fan adjustment
* Add a new luci theme for Raspberry Pi
* Display DNA on cgminer status page

### [http://downloads.canaan-creative.com/software/avalon4/openwrt/20141029_1407/ 20141029]

* First version of Avalon4 firmware

# MM Firmware
##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-11-22/ 20141122]

* Version **401411-cad52ec0**
* Fix the type on DEFAULT MDOULES
* Fix the led status when warning
* Add MM4.1 defines
* Add new power module in test/

##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-11-11/ 20141111]

* Version: **401411-5965e0f0**
* Add ntime offset configure from outside
* Reset globe values when idle
* Update ChangeLog, README and MM_VERSION

##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-11-09/ 20141109]

* Version: **401410-c6ba5180**
* Big Code cleanup, Update MM protocol. 
* Update timeout value to 90% the theory value.
* Fix the hashrate couning.
* Fix watchdog issue. enable watchdog.
* Remove g_module_id check since we use I2C
* Move adjust fan in polling package.
* Update MM idle default fan speed to 10%

##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-11-04/ 20141104]

* Version: **401410-223a1c50**
* Update idle timeout from 5s to 3s
* Display ID on controller LEDs for debug
* Fix the automatic module detect
* Disable watch dog
* IDLE check when both (new stratum) and (module id) was configured

##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-11-01/ 20141101]

* Fix the front led display
* Cutoff power after testing

##[http://downloads.canaan-creative.com/software/avalon4/mm/2014-10-30/ 20141030]

* First version of Avalon4 firmware

## Daily Building

* **http://build.canaan-creative.com:8080/~mikeqin/mm/**

# Design file

* [http://downloads.canaan-creative.com/hardware/A3222/](http://downloads.canaan-creative.com/hardware/A3222/)

# Links

* [Avalon的第四代BTC挖矿芯片A3222 通过了初步的功能测试](http://www.yibite.com/article-4731-1.html)
