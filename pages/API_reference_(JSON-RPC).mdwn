## Controlling Bitcoin

Run *bitcoind* or *bitcoin-qt -server*. You can control it via the command-line or by [HTTP JSON-RPC](http://json-rpc.org/wiki/specification) commands.

You must create a bitcoin.conf configuration file setting an rpcuser and rpcpassword; see [[Running_Bitcoin]] for details.

Now run:
	$ ./bitcoind -daemon
	bitcoin server starting
	$ ./bitcoind help
	# shows the help text

A [[list of RPC calls|Original_Bitcoin_client/API_Calls_list]] will be shown.

	$ ./bitcoind getbalance
	2000.00000

## JSON-RPC

Running Bitcoin with the -server argument (or running bitcoind) tells it to function as a [HTTP JSON-RPC](http://json-rpc.org/wiki/specification) server, but 
[Basic access authentication](http://en.wikipedia.org/wiki/Basic_access_authentication) must be used when communicating with it, and, for security, by default, the server only accepts connections from other processes on the same machine.  If your HTTP or JSON library requires you to specify which 'realm' is authenticated, use 'jsonrpc'.

Bitcoin supports SSL (https) JSON-RPC connections beginning with version 0.3.14.  See the [[rpcssl wiki page|Enabling_SSL_on_original_client_daemon]] for setup instructions and a list of all bitcoin.conf configuration options.

Allowing arbitrary machines to access the JSON-RPC port (using the rpcallowip [[configuration option|Running_Bitcoin]]) is dangerous and **strongly discouraged**-- access should be strictly limited to trusted machines.

To access the server you should find a [suitable library](http://json-rpc.org/wiki/implementations) for your language.

## Proper money handling

See the [[proper money handling page|Proper_Money_Handling_(JSON-RPC)]] for notes on avoiding rounding errors when handling bitcoin values.

## Python

[python-jsonrpc](http://json-rpc.org/wiki/python-json-rpc) is the official JSON-RPC implementation for Python.
It automatically generates Python methods for RPC calls.
However, due to its design for supporting old versions of Python, it is also rather inefficient.
[jgarzik](User:jgarzik) has forked it as [Python-BitcoinRPC](https://github.com/jgarzik/python-bitcoinrpc) and optimized it for current versions.
Generally, this version is recommended.

While BitcoinRPC lacks a few obscure features from jsonrpc, software using only the ServiceProxy class can be written the same to work with either version the user might choose to install:

<source lang="python">
	from jsonrpc import ServiceProxy
	
	access = ServiceProxy("http://user:password@127.0.0.1:8332")
	access.getinfo()
	access.listreceivedbyaddress(6)
	#access.sendtoaddress("11yEmxiMso2RsFVfBcCa616npBvGgxiBX", 10)
</source>

The latest version of python-bitcoinrpc has a new syntax.
<source lang="python">
	from bitcoinrpc.authproxy import AuthServiceProxy
</source>

## Ruby

<source lang="ruby">
require 'net/http'
require 'uri'
require 'json'

class BitcoinRPC
	def initialize(service_url)
	@uri = URI.parse(service_url)
	end

	def method_missing(name, *args)
	post_body = { 'method' => name, 'params' => args, 'id' => 'jsonrpc' }.to_json
	resp = JSON.parse( http_post_request(post_body) )
	raise JSONRPCError, resp[['error']] if resp[['error']]
	resp[['result']]
	end

	def http_post_request(post_body)
	http    = Net::HTTP.new(@uri.host, @uri.port)
	request = Net::HTTP::Post.new(@uri.request_uri)
	request.basic_auth @uri.user, @uri.password
	request.content_type = 'application/json'
	request.body = post_body
	http.request(request).body
	end

	class JSONRPCError < RuntimeError; end
end

if $0 == __FILE__
	h = BitcoinRPC.new('http://user:password@127.0.0.1:8332')
	p h.getbalance
	p h.getinfo
	p h.getnewaddress
	p h.dumpprivkey( h.getnewaddress )
	# also see: https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_Calls_list
end
</source>

## PHP

The [JSON-RPC PHP](http://jsonrpcphp.org/) library also makes it very easy to connect to Bitcoin.  For example:

<source lang="php">
	require_once 'jsonRPCClient.php';
	
	$bitcoin = new jsonRPCClient('http://user:password@127.0.0.1:8332/');
	
	echo "<pre>\n";
  print_r($bitcoin->getinfo()); echo "\n";
  echo "Received: ".$bitcoin->getreceivedbylabel("Your Address")."\n";
  echo "</pre>";
</source>

**Note:** The jsonRPCClient library uses fopen() and will throw an exception saying "Unable to connect" if it receives a 404 or 500 error from bitcoind. This prevents you from being able to see error messages generated by bitcoind (as they are sent with status 404 or 500). The [EasyBitcoin-PHP library](https://github.com/aceat64/EasyBitcoin-PHP) is similar in function to JSON-RPC PHP but does not have this issue.

## Java

The easiest way to tell Java to use HTTP Basic authentication is to set a default Authenticator:

<source lang="java">
	final String rpcuser ="...";
	final String rpcpassword ="...";
	
	Authenticator.setDefault(new Authenticator() {
	protected PasswordAuthentication getPasswordAuthentication() {
	return new PasswordAuthentication (rpcuser, rpcpassword.toCharArray());
	}
	});
</source>

Once that is done, [any JSON-RPC library for Java](http://json-rpc.org/wiki/implementations) (or ordinary URL POSTs) may be used to communicate with the Bitcoin server.

## Perl

The JSON::RPC package from CPAN can be used to communicate with Bitcoin.  You must set the client's credentials; for example:

<source lang="perl">
	use JSON::RPC::Client;
	use Data::Dumper;
	
	my $client = new JSON::RPC::Client;
	
	$client->ua->credentials(
	'localhost:8332', 'jsonrpc', 'user' => 'password'  # REPLACE WITH YOUR bitcoin.conf rpcuser/rpcpassword
	);
	
	my $uri = 'http://localhost:8332/';
	my $obj = {
	method  => 'getinfo',
	params  => [],
	};
	
	my $res = $client->call( $uri, $obj );
	
	if ($res){
	if ($res->is_error) { print "Error : ", $res->error_message; }
	else { print Dumper($res->result); }
	} else {
	print $client->status_line;
	}
</source>

## Go

The [btcrpcclient package](https://github.com/conformal/btcrpcclient) can be used to communicate with Bitcoin.  You must provide credentials to match the client you are communicating with.

<source lang="go">
package main

import (
	"github.com/conformal/btcnet"
	"github.com/conformal/btcrpcclient"
	"github.com/conformal/btcutil"
	"log"
)

func main() {
	// create new client instance
	client, err := btcrpcclient.New(&btcrpcclient.ConnConfig{
	HttpPostMode: true,
	DisableTLS:   true,
	Host:         "127.0.0.1:8332",
	User:         "rpcUsername",
	Pass:         "rpcPassword",
	}, nil)
	if err != nil {
	log.Fatalf("error creating new btc client: %v", err)
	}

	// list accounts
	accounts, err := client.ListAccounts()
	if err != nil {
	log.Fatalf("error listing accounts: %v", err)
	}
	// iterate over accounts (map[[string]]btcutil.Amount) and write to stdout
	for label, amount := range accounts {
	log.Printf("%s: %d", label, amount)
	}

	// prepare a sendMany transaction
	receiver1, err := btcutil.DecodeAddress("1someAddressThatIsActuallyReal", &btcnet.MainNetParams)
	if err != nil {
	log.Fatalf("address receiver1 seems to be invalid: %v", err)
	}
	receiver2, err := btcutil.DecodeAddress("1anotherAddressThatsPrettyReal", &btcnet.MainNetParams)
	if err != nil {
	log.Fatalf("address receiver2 seems to be invalid: %v", err)
	}
	receivers := map[[btcutil.Address]]btcutil.Amount{
	receiver1: btcutil.Amount(42),  // 42 satoshi
	receiver2: btcutil.Amount(100), // 100 satoshi
	}

	// create and send the sendMany tx
	txSha, err := client.SendMany("some-account-label-from-which-to-send", receivers)
	if err != nil {
	log.Fatalf("error sendMany: %v", err)
	}
	log.Printf("sendMany completed! tx sha is: %s", txSha.String())
}
</source>

## .NET (C#)
The communication with rpc service can be achieved using the standard http request/response objects.
A library for serialising and deserializing Json will make your life a lot easier:

Json.Net ( http://james.newtonking.com/json ) is a high performance JSON package for .Net.  It is also available via NuGet from the package manager console ( Install-Package Newtonsoft.Json ).

The following example uses Json.Net:

<source lang="csharp">
	HttpWebRequest webRequest = (HttpWebRequest)WebRequest.Create("http://localhost.:8332");
	webRequest.Credentials = new NetworkCredential("user", "pwd");
	/// important, otherwise the service can't desirialse your request properly
	webRequest.ContentType = "application/json-rpc";
	webRequest.Method = "POST";
	
	JObject joe = new JObject();
	joe.Add(new JProperty("jsonrpc", "1.0"));
	joe.Add(new JProperty("id", "1"));
	joe.Add(new JProperty("method", Method));
	// params is a collection values which the method requires..
	if (Params.Keys.Count == 0)
	{
	joe.Add(new JProperty("params", new JArray()));
	}
	else
	{
	JArray props = new JArray();
	// add the props in the reverse order!
	for (int i = Params.Keys.Count - 1; i >= 0; i--)
	{
	.... // add the params
	}
	joe.Add(new JProperty("params", props));
	}
	
	// serialize json for the request
	string s = JsonConvert.SerializeObject(joe);
	byte[] byteArray = Encoding.UTF8.GetBytes(s);
	webRequest.ContentLength = byteArray.Length;
	Stream dataStream = webRequest.GetRequestStream();
	dataStream.Write(byteArray, 0, byteArray.Length);
	dataStream.Close();
	
	
	WebResponse webResponse = webRequest.GetResponse();
	
	... // deserialze the response
</source>

There is also a wrapper for Json.NET called Bitnet (https://sourceforge.net/projects/bitnet)
implementing Bitcoin API in more convenient way:

<source lang="csharp">
	BitnetClient bc = new BitnetClient("http://127.0.0.1:8332");
	bc.Credentials = new NetworkCredential("user", "pass");

	var p = bc.GetDifficulty();
	Console.WriteLine("Difficulty:" + p.ToString());

	var inf = bc.GetInfo();
	Console.WriteLine("Balance:" + inf[["balance"]]);
</source>

## Node.js

* [node-bitcoin](https://github.com/freewil/node-bitcoin) (npm: bitcoin) 

Example using node-bitcoin:

<source lang="javascript">
var bitcoin = require('bitcoin');
var client = new bitcoin.Client({
	host: 'localhost',
	port: 8332,
	user: 'user',
	pass: 'pass'
});

client.getDifficulty(function(err, difficulty) {
	if (err) {
	return console.error(err);
	}

	console.log('Difficulty: ' + difficulty);
});
</source>

Example using Kapitalize:

<source lang='javascript'>
var client = require('kapitalize')()

client.auth('user', 'password')

client
.getInfo()
.getDifficulty(function(err, difficulty) {
	console.log('Dificulty: ', difficulty)
})
</source>

## Command line (cURL)

You can also send commands and see results using [cURL](http://curl.haxx.se/) or some other command-line HTTP-fetching utility; for example:

<source lang="bash">
	curl --user user --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getinfo", "params": [] }' 
	-H 'content-type: text/plain;' http://127.0.0.1:8332/
</source>

You will be prompted for your rpcpassword, and then will see something like:

<source lang="javascript">
	{"result":{"balance":0.000000000000000,"blocks":59952,"connections":48,"proxy":"","generate":false,
	"genproclimit":-1,"difficulty":16.61907875185736,"error":null,"id":"curltest"}
</source>

## Clojure

[clj-btc](https://github.com/aviad/clj-btc) is a Clojure wrapper for the bitcoin API.

<source lang="clojure">
user=> (require '[:as btc](clj-btc.core))
nil
user=> (btc/getinfo)
{"timeoffset" 0, "protocolversion" 70001, "blocks" 111908, "errors" "",
	"testnet" true, "proxy" "", "connections" 4, "version" 80500,
	"keypoololdest" 1380388750, "paytxfee" 0E-8M,
	"difficulty" 4642.44443532M, "keypoolsize" 101, "balance" 0E-8M,
	"walletversion" 60000}
</source>

## See Also

* [[API calls list|Original_Bitcoin_client/API_Calls_list]]
* [[Running_Bitcoin]]
* [[Lazy_API]]
* [[PHP_developer_intro]]
* [[Raw Transactions API|Raw_Transactions]]
* [Web Based JSON RPC interface.](http://blockchain.info/api/json_rpc_api)

[[!tag "Technical"]]
[[!tag "Developer"]]
[[zh-cn:API_reference_(JSON-RPC)]]
